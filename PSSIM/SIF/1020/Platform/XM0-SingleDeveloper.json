{
    "Parameters": {
        "Apps_LicenseFile": {
            "Type": "String",
            "Description": "The path to the Sitecore license file.",
            "DefaultValue": ".\\License.xml"
        },
        "IdentityServer_CertificateName": {
            "Type": "String",
            "Description": "The name of the certificate to be created for the identity server.",
            "DefaultValue": ""
        },
        "IdentityServer_AppName": {
            "Type": "String",
            "Description": "The name of the identity server to be created.",
            "DefaultValue": "sitecore.auth"
        },
        "Apps_Prefix": {
            "Type": "String",
            "DefaultValue": "SC910",
            "Description": "The prefix for uniquely identifying instances."
        },
        "ContentManagement_AppName": {
            "Type": "string",
            "DefaultValue": "sitecore.cd",
            "Description": "The name of the content management site to be deployed."
        },
        "Sitecore_AdminPassword": {
            "Type": "string",
            "DefaultValue": "",
            "Description": "The admin password for the Sitecore instance."
        },
        "Apps_RootFolder": {
            "Type": "String",
            "Description": "Root folder to install the site to. If left on the default [systemdrive]:\\inetpub\\wwwroot will be used.",
            "DefaultValue": ""
        },
        "SqlServer_AdminUser": {
            "Type": "string",
            "DefaultValue": "sa",
            "Description": "The Sql admin user account to use when installing databases."
        },
        "SqlServer_AdminPassword": {
            "Type": "string",
            "DefaultValue": "12345",
            "Description": "The Sql admin password to use when installing databases."
        },
        "SqlServer_Instance": {
            "Type": "String",
            "DefaultValue": "Localhost",
            "Description": "The Sql Server where databases will be installed."
        },
        "Database_Forms_Password": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Experience Forms connection string in Sitecore."
        },
        "Database_Security_Password": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Security connection string in Sitecore."
        },
        "Database_Core_Password": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Core connection string in Sitecore."
        },
        "Database_Master_Password": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Master connection string in Sitecore."
        },
        "Database_Web_Password": {
            "Type": "string",
            "DefaultValue": "SIF-Default",
            "Description": "The Sql password for the Web connection string in Sitecore."
        },
        "Solr_Url": {
            "Type": "String",
            "DefaultValue": "https://localhost:8983/solr",
            "Description": "The Solr instance to use."
        },
        "Solr_Folder": {
            "Type": "String",
            "DefaultValue": "C:\\solr-8.8.2",
            "Description": "The file path to the Solr instance."
        },
        "Solr_Service": {
            "Type": "String",
            "DefaultValue": "Solr-8.8.2",
            "Description": "The name of the Solr service."
        },
        "ContentManagement_Package": {
            "Type": "String",
            "DefaultValue": "",
            "Description": "The path to the Sitecore package to deploy."
        },
        "IdentityServer_Package": {
            "Type": "String",
            "DefaultValue": "",
            "Description": "The path to the Identity Server package to deploy."
        },
        "IdentityServer_PasswordRecoveryUrl": {
            "Type": "string",
            "Description": "Password recovery Url (Host name of CM instance).",
            "DefaultValue": "http:\\"
        },
        "IdentityServer_ClientsConfiguration": {
            "Type": "string",
            "DefaultValue": "",
            "Description": "Sitecore IdentityServer clients configuration"
        },
        "IdentityServer_AllowedCorsOrigins": {
            "Type": "string",
            "Description": "Pipe-separated list of instances (URIs) that are allowed to login via Sitecore Identity.",
            "DefaultValue": ""
        },
        "IdentityServer_ClientSecret": {
            "Type": "string",
            "Description": "Client secret of PasswordClient section. It's a random string between 1 and 100 symbols long.",
            "DefaultValue": "IdentityServerClientSecret"
        },
        "Sitecore_IdentityAuthority": {
            "Type": "string",
            "DefaultValue": "https://SitecoreIdentityServerHost",
            "Description": "IdentityServer provider URI."
        },
        "Packages_TempLocation": {
            "Type": "String",
            "Description": "Alternative location to save WDP packages. If left on the default $Env:Temp will be used.",
            "DefaultValue": ""
        },
        "Packages_DownloadLocations": {
            "Type": "String",
            "Description": "File with URI and SHA256 hashes of dynamically downloadable WDPs.",
            "DefaultValue": ".\\downloads.json"
        },
        "ContentDelivery_DisableHttps": {
            "Type": "bool",
            "Description": "The option for the enable/disable HTTPS to the Sitecore Content Delivery.",
            "DefaultValue": false
        },
        "Update": {
            "Type": "bool",
            "Description": "The parameter for the installing delta WDP packages.",
            "DefaultValue": false
        },
        "SqlServer_DeployToElasticPoolName": {
            "Type": "String",
            "Description": "The elastic pool name for deploy databases from the SQL Azure.",
            "DefaultValue": ""
        },
        "Sitecore_Solr:solr_Url": {
            "Type": "String",
            "Reference": "Solr_Url",
            "Description": "Override to pass SolrURL value to Sitecore_Solr config."
        },
        "ContentManagment_App:solr_Url": {
            "Type": "String",
            "Reference": "Solr_Url",
            "Description": "Override to pass SolrURL value to ContentManagment_App config."
        },
        "Sitecore_Solr:solr_Path": {
            "Type": "String",
            "Reference": "Solr_Folder",
            "Description": "Override to pass SolrRoot value to Sitecore_Solr config."
        },
        "Sitecore_Solr:solr_Service": {
            "Type": "String",
            "Reference": "Solr_Service",
            "Description": "Override to pass SolrService value to Sitecore_Solr config."
        },
        "Sitecore_Solr:solr_CorePrefix": {
            "Type": "String",
            "Reference": "Apps_Prefix",
            "Description": "Override to pass Prefix value to Sitecore_Solr config."
        },
        "ContentManagment_App:solr_CorePrefix": {
            "Type": "String",
            "Reference": "Apps_Prefix",
            "Description": "Override to pass Prefix value to ContentManagment_App config."
        },
        "ContentManagment_App:app_License": {
            "Type": "String",
            "Reference": "Apps_LicenseFile",
            "Description": "Override to pass LicenseFile value to ContentManagment_App config."
        },
        "IdentityServer_Certificate:certificate_Name": {
            "Type": "String",
            "Reference": "IdentityServer_CertificateName",
            "Description": "Override to pass IdentityServer_CertificateName value to IdentityServer_Certificate config."
        },
        "IdentityServer_Certificate:Update": {
            "Type": "bool",
            "Reference": "Update",
            "Description": "Override to pass Update value to Certificates config."
        },
        "IdentityServer_App:app_Name": {
            "Type": "String",
            "Reference": "IdentityServer_AppName",
            "Description": "Override to pass IdentityServer_AppName value to IdentityServer config."
        },
        "ContentManagment_App:app_Name": {
            "Type": "String",
            "Reference": "ContentManagement_AppName",
            "Description": "Override to pass SitecoreContentManagementSiteName value to ContentManagment_App config."
        },
        "IdentityServer_App:app_Folder": {
            "Type": "String",
            "Reference": "Apps_RootFolder",
            "Description": "Override to pass SiteRoot value to IdentityServer config."
        },
        "ContentManagment_App:app_Folder": {
            "Type": "String",
            "Reference": "Apps_RootFolder",
            "Description": "Override to pass SiteRoot value to ContentManagment_App config."
        },
        "IdentityServer_App:app_Certificate": {
            "Type": "String",
            "Reference": "IdentityServer_CertificateName",
            "Description": "Override to pass IdentityServer_CertificateName value to IdentityServer config."
        },
        "IdentityServer_App:app_License": {
            "Type": "String",
            "Reference": "Apps_LicenseFile",
            "Description": "Override to pass LicenseFile value to IdentityServer config."
        },
        "IdentityServer_App:identityserver_ClientsConfiguration": {
            "Type": "String",
            "Reference": "IdentityServer_ClientsConfiguration",
            "Description": "Override to pass ClientsConfiguration value to IdentityServer config."
        },
        "IdentityServer_App:identityserver_PasswordRecoveryUrl": {
            "Type": "String",
            "Reference": "IdentityServer_PasswordRecoveryUrl",
            "Description": "Override to pass PasswordRecoveryUrl value to IdentityServer config."
        },
        "ContentManagment_App:app_Package": {
            "Type": "String",
            "Reference": "ContentManagement_Package",
            "Description": "Override to pass SitecoreContentManagementPackage value to Sitecore_App config."
        },
        "IdentityServer_App:app_Package": {
            "Type": "String",
            "Reference": "IdentityServer_Package",
            "Description": "Override to pass IdentityServerPackage value to IdentityServer config."
        },
        "ContentManagment_App:sqlserver_DatabasePrefix": {
            "Type": "String",
            "Reference": "Apps_Prefix",
            "Description": "Override to pass Prefix value to ContentManagment_App config."
        },
        "IdentityServer_App:sqlserver_DatabasePrefix": {
            "Type": "String",
            "Reference": "Apps_Prefix",
            "Description": "Override to pass Prefix value to IdentityServer config."
        },
        "ContentManagment_App:sqlserver_Instance": {
            "Type": "String",
            "Reference": "SqlServer_Instance",
            "Description": "Override to pass SqlServer value to ContentManagment_App config."
        },
        "IdentityServer_App:sqlserver_Instance": {
            "Type": "String",
            "Reference": "SqlServer_Instance",
            "Description": "Override to pass SqlServer value to IdentityServer config."
        },
        "ContentManagment_App:sqlserver_AdminUser": {
            "Type": "String",
            "Reference": "SqlServer_AdminUser",
            "Description": "Override to pass SqlServer_AdminUser value to ContentManagment_App config."
        },
        "ContentManagment_App:sqlserver_AdminPassword": {
            "Type": "String",
            "Reference": "SqlServer_AdminPassword",
            "Description": "Override to pass SqlServer_AdminPassword value to ContentManagment_App config."
        },
        "IdentityServer_App:identityserver_AllowedCorsOrigins": {
            "Type": "String",
            "Reference": "IdentityServer_AllowedCorsOrigins",
            "Description": "Override to pass AllowedCorsOrigins value to IdentityServer config."
        },
        "ContentManagment_App:sitecore_IdentityAuthority": {
            "Type": "String",
            "Reference": "Sitecore_IdentityAuthority",
            "Description": "Override to pass SitecoreIdentityAuthority value to ContentManagment_App config."
        },
        "IdentityServer_App:packages_TemporaryLocation": {
            "Type": "String",
            "Reference": "Packages_TempLocation",
            "Description": "Override to pass PackagesTempLocation value to IdentityServer config."
        },
        "ContentManagment_App:packages_TemporaryLocation": {
            "Type": "String",
            "Reference": "Packages_TempLocation",
            "Description": "Override to pass PackagesTempLocation name value to ContentManagment_App config."
        },
        "IdentityServer_App:packages_DownloadLocations": {
            "Type": "String",
            "Reference": "Packages_DownloadLocations",
            "Description": "Override to pass DownloadLocations value to IdentityServer config."
        },
        "ContentDelivery_App:packages_DownloadLocations": {
            "Type": "String",
            "Reference": "Packages_DownloadLocations",
            "Description": "Override to pass DownloadLocations name value to ContentDelivery_App config."
        },
        "ContentManagment_App:packages_DownloadLocations": {
            "Type": "String",
            "Reference": "Packages_DownloadLocations",
            "Description": "Override to pass DownloadLocations name value to ContentManagment_App config."
        },
        "ContentManagment_App:sitecore_AdminPassword": {
            "Type": "String",
            "Reference": "Sitecore_AdminPassword",
            "Description": "Override to pass SitecoreAdminPassword name value to ContentManagment_App config."
        },
        "ContentManagment_App:Update": {
            "Type": "bool",
            "Reference": "Update",
            "Description": "Override to pass Update value to ContentManagment_App config."
        },
        "IdentityServer_App:Update": {
            "Type": "bool",
            "Reference": "Update",
            "Description": "Override to pass Update value to IdentityServer config."
        },
        "Sitecore_Solr:Update": {
            "Type": "bool",
            "Reference": "Update",
            "Description": "Override to pass Update value to Sitecore_Solr config."
        },
        "ContentManagment_App:sqlserver_DeployToElasticPoolName": {
            "Type": "String",
            "Reference": "SqlServer_DeployToElasticPoolName",
            "Description": "Override to pass DeployToElasticPoolName value to ContentManagment_App config."
        }
    },
    "Variables": {
        "Sql.Database.Core.Password": "[if(variable('Sql.Database.Core.Password.Test'),variable('Sql.Database.Core.Password.Generate'),parameter('Database_Core_Password'))]",
        "Sql.Database.Core.Password.Test": "[equal(parameter('Database_Core_Password'),'SIF-Default')]",
        "Sql.Database.Core.Password.Generate": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "ContentManagment_App:Sql.Database.Core.Password": "[variable('Sql.Database.Core.Password')]",

        "Sql.Database.Security.Password": "[if(variable('Sql.Database.Security.Password.Test'),variable('Sql.Database.Security.Password.Generate'),parameter('Database_Security_Password'))]",
        "Sql.Database.Security.Password.Test": "[equal(parameter('Database_Security_Password'),'SIF-Default')]",
        "Sql.Database.Security.Password.Generate": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "ContentManagment_App:Sql.Database.Security.Password": "[variable('Sql.Database.Security.Password')]",
        "IdentityServer_App:Sql.Database.Security.Password": "[variable('Sql.Database.Security.Password')]",

        "Sql.Database.Master.Password": "[if(variable('Sql.Database.Master.Password.Test'),variable('Sql.Database.Master.Password.Generate'),parameter('Database_Master_Password'))]",
        "Sql.Database.Master.Password.Test": "[equal(parameter('Database_Master_Password'),'SIF-Default')]",
        "Sql.Database.Master.Password.Generate": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "ContentManagment_App:Sql.Database.Master.Password": "[variable('Sql.Database.Master.Password')]",

        "Sql.Database.Web.Password": "[if(variable('Sql.Database.Web.Password.Test'),variable('Sql.Database.Web.Password.Generate'),parameter('Database_Web_Password'))]",
        "Sql.Database.Web.Password.Test": "[equal(parameter('Database_Web_Password'),'SIF-Default')]",
        "Sql.Database.Web.Password.Generate": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "ContentManagment_App:Sql.Database.Web.Password": "[variable('Sql.Database.Web.Password')]",

        "Sql.Database.Forms.Password": "[if(variable('Sql.Database.Forms.Password.Test'),variable('Sql.Database.Forms.Password.Generate'),parameter('Database_Forms_Password'))]",
        "Sql.Database.Forms.Password.Test": "[equal(parameter('Database_Forms_Password'),'SIF-Default')]",
        "Sql.Database.Forms.Password.Generate": "[randomstring(Length:20,DisAllowSpecial:True,EnforceComplexity:True)]",

        "ContentManagment_App:Sql.Database.Forms.Password": "[variable('Sql.Database.Forms.Password')]",

        "IdentityServer.Client.Secret": "[if(variable('IdentityServer.Client.Secret.Test'),variable('IdentityServer.Client.Secret.Generate'),parameter('IdentityServer_ClientSecret'))]",
        "IdentityServer.Client.Secret.Test": "[equal(parameter('IdentityServer_ClientSecret'),'SIF-Default')]",
        "IdentityServer.Client.Secret.Generate": "[randomstring(Length:100,DisAllowSpecial:True)]",

        "IdentityServer_App:IdentityServer.Client.Secret": "[variable('IdentityServer.Client.Secret')]",
        "ContentManagment_App:IdentityServer.Client.Secret": "[variable('IdentityServer.Client.Secret')]"
    },
    "Includes": {
        "IdentityServer_Certificate": {
            "Source": ".\\..\\Certificates\\createcert.json"
        },
        "IdentityServer_App": {
            "Source": ".\\identityServer.json"
        },
        "Sitecore_Certificate": {
            "Source": ".\\..\\Certificates\\createcert.json"
        },
        "Sitecore_Solr": {
            "Source": ".\\Sitecore-solr.json"
        },
        "ContentManagment_App": {
            "Source": ".\\Sitecore-XM0.json"
        }
    },
    "Register": {
        "Tasks": {
            "SetVariable": "Set-Variable"
        }
    },
    "Tasks": {
        "GeneratePasswords": {
            "Description": "Generates all shared passwords and secrets.",
            "Type": "SetVariable",
            "Params": {
                "Name": "XM1Passwords",
                "Scope": "Global",
                "Value": [
                    {
                        "Database_Core_Password": "[variable('Sql.Database.Core.Password')]"
                    },
                    {
                        "Database_Security_Password": "[variable('Sql.Database.Security.Password')]"
                    },
                    {
                        "Database_Master_Password": "[variable('Sql.Database.Master.Password')]"
                    },
                    {
                        "Database_Web_Password": "[variable('Sql.Database.Web.Password')]"
                    },
                    {
                        "Database_Forms_Password": "[variable('Sql.Database.Forms.Password')]"
                    },
                    {
                        "IdentityServer_ClientSecret": "[variable('IdentityServer.Client.Secret')]"
                    }
                ]
            },
            "Skip": "[parameter('Update')]"
        }
    }
}
